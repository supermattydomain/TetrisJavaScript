<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Tetris</title>
<link rel="stylesheet" type="text/css" href="styles.css">
<script language="javascript" type="text/javascript" src="../lib/jquery/dist/jquery.js"></script>
<script language="javascript" type="text/javascript" src="../lib/JSON-js/json2.js"></script>
<script language="javascript" type="text/javascript" src="../lib/jsdebug/debug.js"></script>
<script language="javascript" type="text/javascript" src="tetris.js"></script>
</head>
<body>
<h1>Tetris</h1>

<div id="displayDiv" class="display">
<div id="boardDiv" class="board"></div>
<div id="nextShapeDiv" class="nextShape"></div>
</div>

<div id="controls" class="controls">
	<form action="" onsubmit="return false;">
		<input type="button" onclick="board.clear();textarea.focus();return false;" value="Clear">
		<input type="button" id="toggleButton" onclick="toggleRunning(1000);textarea.focus();return false;" value="Go">
		<textarea rows="1" cols="1" id="dummytextarea"></textarea>
	</form>
</div>

<script language="javascript" type="text/javascript"><!--
var width = 10;
var height = 20;
var nextShapeDisplay = new Tetris.NextShapeDisplay($('#nextShapeDiv'));
// TODO: Remove ugly textarea.
// The div doesn't seem able to get keyboard focus,
// so doesn't receive keyboard events.
var textarea = $('#dummytextarea');
textarea.prop('readonly', true);
var board = new Tetris.TetrisBoard(width, height, $('#boardDiv'), textarea);

var interval;

function timerFunc() {
	if (board.tick()) {
		nextShapeDisplay.display(board.nextType);
	} else {
		debug('You lose!');
		stopRunning();
	}
}

function startRunning(delay) {
	interval = setInterval("timerFunc()", delay);
	$('#toggleButton').val('Pause');
}

function stopRunning() {
	clearInterval(interval);
	interval = undefined;
	$('#toggleButton').val('Go');
}

function toggleRunning(delay) {
	if (interval) {
		stopRunning();
	} else {
		startRunning(delay);
	}
}

// --></script>

</body>
</html>
